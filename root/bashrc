#!/bin/bash

set -o vi

export VIMRC_ROOT=$HOME/vimrc/root
export EDITOR=vim

. $VIMRC_ROOT/z.sh

alias start='cmd.exe /C start ""'

# cmd.exe /c mklink /d parameter_server  "D:\doc2\cs\aisys\parameter_server"
mklinkd() {
	if [ $# -eq 2 ]; then
		target=$2
		target=${target/\/mnt\/d/D:}
		target=${target//\//\\}
		echo 'create link: ' $1 ' target: ' $target
		cmd.exe /c mklink /d $1 $target
	elif [ $# -eq 1 ]; then
		# mklinkd /mnt/d/doc2/cs/aisys
		target=$1
		link=${target##*/} # link = "aisys"
		target=${target/\/mnt\/d/D:}
		echo $target
		target=${target//\//\\}
		echo 'create link: ' $link ' target: ' $target
		cmd.exe /c mklink /d $link $target
	fi
}

mklink() {
	if [ $# -eq 2 ]; then
		target=$2
		target=${target/\/mnt\/d/D:}
		target=${target//\//\\}
		echo 'create link: ' $1 ' target: ' $target
		cmd.exe /c mklink $1 $target
	elif [ $# -eq 1 ]; then
		# mklinkd /mnt/d/doc2/cs/aisys
		target=$1
		link=${target##*/} # link = "aisys"
		target=${target/\/mnt\/d/D:}
		echo $target
		target=${target//\//\\}
		echo 'create link: ' $link ' target: ' $target
		cmd.exe /c mklink $link $target
	fi
}

alias vimt='vim --servername TEX'
alias vimhelp='vim -c ":Lines!" ~/.vim/doc/mydoc.txt'

source $VIMRC_ROOT/fzf/fzf.bash
source $VIMRC_ROOT/vimdf

# 还有rga
# https://github.com/phiresky/ripgrep-all

export PATH=$PATH:$VIMRC_ROOT/scripts
RGPIPE='rgpipe'
alias rgi="rg -i -z --max-columns-preview --max-columns 500 --hidden --no-ignore --pre-glob \
	'*.{pdf,xl[tas][bxm],xl[wsrta],do[ct],do[ct][xm],p[po]t[xm],p[op]t,html,htm,xhtm,xhtml,epub,chm,od[stp]}' --pre ${RGPIPE}"

export RIPGREP_CONFIG_PATH="$HOME/.ripgreprc"
# pygments支持更多语言
export GTAGSLABEL=native-pygments

if [[ `uname -a` == *WSL* ]]; then
	. $VIMRC_ROOT/wsl-init.bash
fi

git-rm-remote-file() {
	(set -x; git filter-branch --force --index-filter "git rm --cached --ignore-unmatch $1" --prune-empty --tag-name-filter cat -- --all)
}

# 将第一个参数的文件名替换为后续多个参数用'-'连接的字符串
# 例如: rename a.txt b c d
# 将a.txt重命名为b-c-d.txt
rename() {
	if [ $# -lt 2 ]; then
		echo "usage: rename oldname newname"
		return
	fi
	oldname=$1
	newname=$2
	shift 2
	for i in $@; do
		newname=$newname-$i
	done
	ext=${oldname##*.}
	newname=$newname.$ext
	echo "rename $oldname to $newname"
	mv $oldname $newname
}
